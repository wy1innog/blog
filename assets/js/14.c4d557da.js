(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{428:function(a,s,e){"use strict";e.r(s);var t=e(2),r=Object(t.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"编译技巧"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编译技巧"}},[a._v("#")]),a._v(" 编译技巧")]),a._v(" "),s("p",[a._v("持续更新...")]),a._v(" "),s("h2",{attrs:{id:"android10关闭dex优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#android10关闭dex优化"}},[a._v("#")]),a._v(" Android10关闭dex优化")]),a._v(" "),s("p",[s("code",[a._v("Android Q")]),a._v("中按照以往方法修改"),s("code",[a._v("frameworks/base/core/")]),a._v("目录，然后在根目录"),s("code",[a._v("make framework")]),a._v("编译出的"),s("code",[a._v("framework.jar")]),a._v("，直接"),s("code",[a._v("adb push")]),a._v("到手机"),s("code",[a._v("system/framework/")]),a._v("目录下，重启机器会出现无法启动现象，循环报出"),s("code",[a._v("boot image")]),a._v("异常，导致"),s("code",[a._v("system server")]),a._v("无法启动。")]),a._v(" "),s("h3",{attrs:{id:"解决方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决方法"}},[a._v("#")]),a._v(" "),s("strong",[a._v("解决方法")])]),a._v(" "),s("p",[a._v("修改"),s("code",[a._v("build/make/core")]),a._v("目录下的"),s("code",[a._v("board_config.mk")]),a._v("和"),s("code",[a._v("dex_preopt_config.mk")]),a._v("文件。")]),a._v(" "),s("ol",[s("li",[s("p",[s("code",[a._v("board_config.mk")]),a._v("文件，修改：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("WITH_DEXPREOPT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" ture\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("为")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("WITH_DEXPREOPT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[s("code",[a._v("dex_preopt_config.mk")]),a._v("文件，修改：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("WITH_DEXPREOPT_BOOT_IMG_AND_SYSTEM_SERVER_ONLY")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" ture\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("为")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("WITH_DEXPREOPT_BOOT_IMG_AND_SYSTEM_SERVER_ONLY")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("注释如下逻辑：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("ifeq "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("filter eng"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TARGET_BUILD_VARIANT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n  ifneq "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("WITH_DEXPREOPT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    ifneq "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("WITH_DEXPREOPT_BOOT_IMG_AND_SYSTEM_SERVER_ONLY")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n      $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("call pretty"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DEXPREOPT")]),a._v(" must be enabled "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" user and userdebug builds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    endif\n  endif\nendif\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])])])]),a._v(" "),s("p",[a._v("修改完之后，全编代码，刷编译完成后的版本，后面就可以在修改完"),s("code",[a._v("frameworks/base/")]),a._v("后在根目录执行"),s("code",[a._v("make framework")]),a._v("，然后将生成的"),s("code",[a._v("framework.jar")]),a._v(" "),s("code",[a._v("push")]),a._v("到手机"),s("code",[a._v("system/framework/")]),a._v("验证修改。")]),a._v(" "),s("h3",{attrs:{id:"刷入手机验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#刷入手机验证"}},[a._v("#")]),a._v(" "),s("strong",[s("strong",[a._v("刷入手机验证")])])]),a._v(" "),s("p",[a._v("编译完成之后的产物目录")]),a._v(" "),s("p",[s("code",[a._v("android-10.0.0_r41\\out\\target\\product\\blueline\\system\\framework\\framework.jar")])]),a._v(" "),s("p",[a._v("目录下有一个"),s("code",[a._v("framework.jar")]),a._v("(这个"),s("code",[a._v("jar")]),a._v("就是框架的代码)\n里面都是"),s("code",[a._v("dex")]),a._v("，如果想看代码，可以去这个目录下看，就好像平时看第三方"),s("code",[a._v("jar")]),a._v("一样，导入"),s("code",[a._v("as")]),a._v("即可。")]),a._v(" "),s("p",[s("code",[a._v("android-10.0.0r41\\out\\soong.intermediates\\frameworks\\base\\framework\\androidcommon\\jarjar\\framework.jar")])]),a._v(" "),s("p",[a._v("开始刷入。")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 获取root权限")]),a._v("\nadb root  \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 关闭检测功能")]),a._v("\nadb disable"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("verity \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 关闭检测之后需要重启机器")]),a._v("\nadb reboot \n\n重启机器成功之后：\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 再次获取root权限")]),a._v("\nadb root  \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 重启挂载system分区为可读写分区")]),a._v("\nadb remount  \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 推送framework.jar")]),a._v("\n\nadb root "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" adb remount\n\nadb push framework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("jar "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("system"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("framework\n\nadb reboot\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br")])]),s("p",[a._v("由于关闭了"),s("code",[a._v("dex")]),a._v("优化，这里就不需要删除什么"),s("code",[a._v("odex")]),a._v("和"),s("code",[a._v("arm")]),a._v("下面的东西。")]),a._v(" "),s("p",[a._v("关闭之后需要全编译，建议在第一次编译系统的时候就关闭，后面更新"),s("code",[a._v("jar")]),a._v("方便多了，不会遇到卡开机问题。")]),a._v(" "),s("h3",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" "),s("strong",[a._v("总结")])]),a._v(" "),s("ol",[s("li",[a._v("方便后面修改模块和验证，建议从开始就关闭"),s("code",[a._v("dex")]),a._v("优化。")]),a._v(" "),s("li",[a._v("修改单个模块之后，去模块的目录下看看是否有"),s("code",[a._v("mk")]),a._v("文件，如果有在目录下"),s("code",[a._v("mm")]),a._v("编译即可。")]),a._v(" "),s("li",[a._v("刷入手机可能会失败，先准备好代码分支对应的官方刷机包，随时刷回去官方的，保证我们下次刷入自己编译的顺利。")])]),a._v(" "),s("hr"),a._v(" "),s("h2",{attrs:{id:"常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[a._v("#")]),a._v(" 常用命令")]),a._v(" "),s("h3",{attrs:{id:"编译命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编译命令"}},[a._v("#")]),a._v(" 编译命令")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("make snod")]),a._v(": 打包"),s("code",[a._v("out/target/product/xxx/system")]),a._v("的内容并生成新的"),s("code",[a._v("system.img")]),a._v("文件")]),a._v(" "),s("li",[s("code",[a._v("make vnod")]),a._v(": 从构建系统中快速编译出"),s("code",[a._v("vendor.img")])]),a._v(" "),s("li",[s("code",[a._v("make pnod")]),a._v(": 从构建系统中快速编译出"),s("code",[a._v("product.img")])]),a._v(" "),s("li",[s("code",[a._v("make senod")]),a._v(": 从构建系统中快速编译出"),s("code",[a._v("system_ext.img")])]),a._v(" "),s("li",[s("code",[a._v("make onod")]),a._v(":从构建系统中快速编译出"),s("code",[a._v("odm.img")])])]),a._v(" "),s("h3",{attrs:{id:"清除命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#清除命令"}},[a._v("#")]),a._v(" 清除命令")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("m clobber")]),a._v(": 清除所有编译缓存，相当于"),s("code",[a._v("rm -rf out/")])]),a._v(" "),s("li",[s("code",[a._v("m clean")]),a._v(": 清除编译缓存，相当于"),s("code",[a._v("rm -rf out/target/product/[product_name]")])]),a._v(" "),s("li",[s("code",[a._v("m installclean")]),a._v(": 清除所有二进制文件")])]),a._v(" "),s("h3",{attrs:{id:"跳转命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跳转命令"}},[a._v("#")]),a._v(" 跳转命令")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("croot")]),a._v(": 可以快速回到"),s("code",[a._v("android")]),a._v("源码根目录")]),a._v(" "),s("li",[s("code",[a._v("godir [file name]")]),a._v(": 定位到包含指定文件的目录下，"),s("code",[a._v("file name")]),a._v("采用模糊匹配，如果有多个目录包含指定的"),s("code",[a._v("file name")]),a._v("，则需要手动选择")])]),a._v(" "),s("h3",{attrs:{id:"查找命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查找命令"}},[a._v("#")]),a._v(" 查找命令")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("jgrep")]),a._v(": 在所有的"),s("code",[a._v("java")]),a._v("文件上执行"),s("code",[a._v("grep")]),a._v("指令")]),a._v(" "),s("li",[s("code",[a._v("cgrep")]),a._v(": 在所有的"),s("code",[a._v("c/c++")]),a._v("文件上执行"),s("code",[a._v("grep")]),a._v("指令")]),a._v(" "),s("li",[s("code",[a._v("rgrep")]),a._v(": 在所有的"),s("code",[a._v("res/*.xml")]),a._v("文件上执行"),s("code",[a._v("grep")]),a._v("指令")]),a._v(" "),s("li",[s("code",[a._v("ggrep")]),a._v(": 在所有的"),s("code",[a._v("Gradle")]),a._v("文件上执行"),s("code",[a._v("grep")]),a._v("指令")]),a._v(" "),s("li",[s("code",[a._v("mangrep")]),a._v(": 在所有的"),s("code",[a._v("androidmanifest.xml")]),a._v("文件上执行"),s("code",[a._v("grep")]),a._v("指令")]),a._v(" "),s("li",[s("code",[a._v("mgrep")]),a._v(": 在所有的"),s("code",[a._v("Makefiles")]),a._v("和"),s("code",[a._v("*.bp")]),a._v("文件上执行"),s("code",[a._v("grep")]),a._v("指令")]),a._v(" "),s("li",[s("code",[a._v("segrep")]),a._v(": 在所有的"),s("code",[a._v("sepolicy")]),a._v("文件上执行"),s("code",[a._v("grep")]),a._v("指令")]),a._v(" "),s("li",[s("code",[a._v("sgrep")]),a._v(": 在所有的文件上执行"),s("code",[a._v("grep")]),a._v("指令")])]),a._v(" "),s("h3",{attrs:{id:"其他指令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他指令"}},[a._v("#")]),a._v(" 其他指令")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("printconfig")]),a._v(": 显示当前编译环境的配置信息")]),a._v(" "),s("li",[s("code",[a._v("allmod")]),a._v(": 显示"),s("code",[a._v("AOSP")]),a._v("所有的"),s("code",[a._v("module")])]),a._v(" "),s("li",[s("code",[a._v("pathmod [module name]")]),a._v(": 显示"),s("code",[a._v("module name")]),a._v("所在的路径")]),a._v(" "),s("li",[s("code",[a._v("refreshmod")]),a._v(": 刷新"),s("code",[a._v("module")]),a._v("列表")]),a._v(" "),s("li",[s("code",[a._v("gomod [module name]")]),a._v(": 定位到指定的"),s("code",[a._v("module name")]),a._v("目录下")])])])}),[],!1,null,null,null);s.default=r.exports}}]);