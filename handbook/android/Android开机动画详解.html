<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Android开机动画详解 | 我要蓝</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="start learn Android Framework">
    
    <link rel="preload" href="/blog/assets/css/0.styles.22a11561.css" as="style"><link rel="preload" href="/blog/assets/js/app.a89a3ba2.js" as="script"><link rel="preload" href="/blog/assets/js/3.b8b532c4.js" as="script"><link rel="preload" href="/blog/assets/js/1.4116e08c.js" as="script"><link rel="preload" href="/blog/assets/js/13.c337f25e.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.256ac970.js"><link rel="prefetch" href="/blog/assets/js/11.09d62205.js"><link rel="prefetch" href="/blog/assets/js/12.eb8f308d.js"><link rel="prefetch" href="/blog/assets/js/14.c4d557da.js"><link rel="prefetch" href="/blog/assets/js/15.1cc4f654.js"><link rel="prefetch" href="/blog/assets/js/16.78f4eb34.js"><link rel="prefetch" href="/blog/assets/js/17.758f5b42.js"><link rel="prefetch" href="/blog/assets/js/18.c2e5bf9f.js"><link rel="prefetch" href="/blog/assets/js/19.89036e2f.js"><link rel="prefetch" href="/blog/assets/js/4.1c7aa095.js"><link rel="prefetch" href="/blog/assets/js/5.ae39bca9.js"><link rel="prefetch" href="/blog/assets/js/6.a2711616.js"><link rel="prefetch" href="/blog/assets/js/7.eb9034a0.js"><link rel="prefetch" href="/blog/assets/js/8.ac666e15.js"><link rel="prefetch" href="/blog/assets/js/9.52ebb6c2.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.22a11561.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>我要蓝</h3> <p class="description" data-v-59e6cb88>start learn Android Framework</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>wyanlin</span>
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">我要蓝</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      我的Github
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/wy1innog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="http://wy1in-md-picture.oss-cn-shanghai.aliyuncs.com/blog/avator/avator.jpg" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    wyanlin
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>8</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>0</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      我的Github
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/wy1innog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/blog/handbook/android/自定义系统服务" class="sidebar-heading clickable open"><span>Android系统</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/android/自定义系统服务.html" class="sidebar-link">自定义系统服务</a></li><li><a href="/blog/handbook/android/自定义按键添加.html" class="sidebar-link">自定义按键添加</a></li><li><a href="/blog/handbook/aidl/aidl.html" class="sidebar-link">AIDL详解</a></li><li><a href="/blog/handbook/android/Android开机动画详解.html" class="active sidebar-link">Android开机动画详解</a></li><li><a href="/blog/handbook/android/编译技巧.html" class="sidebar-link">编译技巧</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/handbook/telephony/Android4.4网络上报流程" class="sidebar-heading clickable"><span>Telephony</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/telephony/Android4.4网络上报流程.html" class="sidebar-link">Android4.4 网络上报流程</a></li><li><a href="/blog/handbook/telephony/Android4.4短信发送接收流程.html" class="sidebar-link">Android4.4 短信发送接收流程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/handbook/problem/Wifi跨进程调用root权限" class="sidebar-heading clickable"><span>问题记录</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/problem/Wifi跨进程调用root权限.html" class="sidebar-link">Wifi跨进程调用root权限</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88></h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>wyanlin</span>
          
        <!---->
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">Android开机动画详解</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>wyanlin</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="android开机动画详解"><a href="#android开机动画详解" class="header-anchor">#</a> Android开机动画详解</h1> <h2 id="环境"><a href="#环境" class="header-anchor">#</a> 环境</h2> <p>展锐</p> <ul><li><code>Android10</code></li> <li><code>Android11</code></li></ul> <h1 id="一、播放文件介绍"><a href="#一、播放文件介绍" class="header-anchor">#</a> 一、播放文件介绍</h1> <p><code>bootanimation.zip</code>一般位于设备<code>system/media/</code>目录下，用于作为开机动画</p> <p>根据设备的分辨率制作开机动画，分辨率可通过以下命令获取</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>adb shell wm size
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>获取到开机动画资源后，需要修改<code>desc.txt</code>，并将其<code>push</code>到设备的<code>system/media/</code>目录下查看是否可生效</p> <h2 id="_1-1-bootanimation-zip文件详解"><a href="#_1-1-bootanimation-zip文件详解" class="header-anchor">#</a> 1.1 bootanimation.zip文件详解</h2> <p><code>bootanimation.zip</code>文件中会有一个<code>desc.txt</code>文件和若干个类似<code>part0</code>、<code>part1</code>的目录。</p> <p>其中<code>desc.txt</code>文件是必须的，而<code>part0</code>、<code>part1</code>这样的目录至少要有一个，多者不限。如果打开<code>part0</code>目录，会发现该目录中都是图像文件（一般是<code>jpg</code>或<code>png</code>格式），而且图像文件名都是按顺序起的，例如，<code>CM10_000.jpg</code>、<code>CM10_001.jpg</code>、<code>CM10_002.jpg</code>。如果有<code>part1</code>、<code>part2</code>这样的目录，在这些目录中的图像文件命名规则与<code>part0</code>类似。这些图像文件就是组成开机动画的静态图像。<code>Android</code>系统中读取这些静态图像，并按一定的显示规律和频率产生动画效果，而描述这些信息的就是<code>desc.txt</code>文件。
注意，有一些开机动画文件中的<code>part1</code>、<code>part2</code>等目录的图像文件名是接着<code>part0</code>目录中图像文件名来的，也就是说假设<code>part0</code>目录中最后一个图像文件的名称为<code>CM10_100.jpg</code>，在<code>part1</code>中的第一个图像文件名为<code>CM10_101.jpg</code>。从表面上看好像<code>part1</code>中的图像文件命名需要接着<code>part0</code>来，不过实际上这并不必要，<code>part1</code>中的图像文件可以任意起名，只要这些动画图像文件的显示顺序与文件命名顺序一致即可。</p> <h2 id="_1-2-desc-txt文件格式"><a href="#_1-2-desc-txt文件格式" class="header-anchor">#</a> 1.2 desc.txt文件格式</h2> <p>开机动画描述文件<code>desc.txt</code>，有<code>1+N</code>行内容构成
现在打开<code>desc.txt</code>文件，通常的内容会显示类似如下的3行。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>768 1366 20  // 768 1366表示动画在屏幕中的显示宽、高，20表示帧率为【1/20 s】
p 0 1 part0  // 第一组动画，0表示无限循环播放，1表示与下一次动画播放之间间隔的时间【1帧 * fps】，part0表示播放part0目录中的所有图像帧
c 1 0 part1  // 第二组动画，1表示播放1次，0表示本次动画播放结束后，立即播放下一次动画，part1表示表示播放part1目录中的所有图像帧

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>下面我们就从上到下，从左到右解释一下这3行的每一部分都代表什么含义。</p> <ul><li>768：动画的宽度。</li> <li>1366：动画的高度。</li> <li>15：每秒播放多少帧图像，这里是每秒播放15帧图像。</li> <li>p：第二行和第三行的<code>p</code>分别定义了两个<code>part</code>。除了第一行外的其他行，通常是以<code>p</code>开头的。</li> <li>1：对<code>part</code>中的静态图像循环播放的次数。第二行为<code>1</code>，表示<code>part0</code>中的静态图像除了正常播放一次外，还会再重复播放一次。而第三行为<code>0</code>，表示只播放part1中静态图像一次。</li> <li>0：播放完当前<code>part</code>动画后暂停的帧数。本例是<code>0</code>，表示播放完<code>part0</code>中的动画后，会立刻播放<code>part1</code>中的动画。假设该值为<code>40</code>（第二行为<code>p 1 40 part0</code>），则表示播放完<code>part0</code>后，会暂停<code>40</code>帧的时间，也就是<code>40/15=2.66</code>秒。</li> <li><code>part0</code>、<code>part1</code>：存储静态图像文件的目录名。
从这些描述可以总结出<code>desc.txt</code>文件的通用格式如下：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>    [width] [height] [frame-rate]
    p [loop] [pause] [folder]
    p [loop] [pause] [folder]
    ……
    p [loop] [pause] [folder]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>其中中括号中的值都可能根据不同的开机动画而变化。下面再简要描述一下这些可变值的含</p> <ul><li><code>width</code>：动画播放的宽度。</li> <li><code>height</code>：动画播放的高度。</li> <li><code>frame-rate</code>：每秒播放的帧数。尽管该值没要求具体的范围，但最好不要超过30，否则<code>Android</code>设备可能由于耗费大量<code>CPU</code>资源处理开机动画造成开机机器缓慢。</li> <li><code>loop</code>：当前<code>part</code>动画循环才次数。</li> <li><code>pause</code>：当前<code>part</code>动画播放完后暂停的帧数。</li> <li><code>folder</code>：当前<code>part</code>动画对应的静态图像文件存储的目录名称。</li></ul> <p>对于<code>width</code>和<code>height</code>要注意的是如果<code>width</code>和<code>height</code>大于当前<code>Android</code>设备的分辨率，则以当前<code>Android</code>设备的分辨率为准，也就是说动画总会尽量充满整个屏幕。
最后按着上面的描述编写完<code>desc.txt</code>文件以及放好相应的图像文件后，将这些文件和目录压缩成<code>bootanimation.zip</code>文件，并按着本节开头介绍的方法更新系统中的<code>bootanimation.zip</code>文件即可。</p> <p>需要注意最后一行要有一个<strong>回车</strong></p> <h1 id="二、修改方式"><a href="#二、修改方式" class="header-anchor">#</a> 二、修改方式</h1> <h2 id="_2-1-测试开机动画"><a href="#_2-1-测试开机动画" class="header-anchor">#</a> 2.1 测试开机动画</h2> <ol><li><p>先连接设备通过<code>adb shell wm size</code>获取设备的屏幕分辨率</p></li> <li><p>如果设备系统本身有开机动画，则<code>adb pull system/mdeia/bootanimation.zip .</code>到本地，在它的基础上进行修改； 如果系统本身没有开机动画，则按照需求和获取的分辨率让UI做开机动画</p></li> <li><p>解压<code>bootanimation.zip</code>，文件夹可能有一个<code>partx</code>，图片格式是<code>png</code>，存入的格式也应该是<code>png</code>，图片的分辨率，根据显示屏的分辨率，<strong>不能大于显示分辨率</strong></p></li> <li><p>打开desc.txt文件，<strong>需要注意最后一行是个回车</strong>，其他的按照需求设置，如：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token number">720</span> <span class="token number">1520</span> <span class="token number">20</span>
p <span class="token number">0</span> <span class="token number">0</span> part0

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>解释为：宽<code>720</code>，高<code>1520</code>，每秒播放<code>20</code>帧，无限循环播放<code>part0</code>文件夹内容，每次播放间隔<code>0</code>秒</p></li> <li><p>一定<strong>不要</strong>先建一个<code>bootanimation</code>文件夹，再压缩，要先选择要压缩的文件，包括<code>part*</code>文件加和<code>desc.txt</code>，再右键添加到压缩文件夹，生成<code>bootanimation.zip</code></p> <p>打包格式：选择<code>zip</code>格式，压缩方式选择<strong>仅存储</strong></p></li> <li><p><code>adb push</code>到<code>/system/media/</code>目录下测试</p></li> <li><p>如果有集成到系统需要，执行下方步骤</p></li></ol> <h2 id="_2-2-集成到系统中"><a href="#_2-2-集成到系统中" class="header-anchor">#</a> 2.2 集成到系统中</h2> <p>如果集成到系统中，只需要把测试成功的<code>bootanimation.zip</code>资源包想办法在编译时自动把它拷贝到<code>system/media/</code>目录下即可</p> <ol><li><p>不同项目可能不一样，在源码<code>device/</code>目录下，找到对应的项目代码，添加<code>media</code>文件夹，把<code>bootanimation.zip</code>放进去</p> <p>如放到了<code>device/sprd/qogirn6pro/jsp1621/media/</code>目录下</p></li> <li><p>在项目源码<code>device</code>目录下<code>mk</code>文件中，添加以下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>+PRODUCT_COPY_FILES +=\
+       device/sprd/qogirn6pro/jsp1621/media/bootanimation.zip:system/media/bootanimation.zip
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>表示把<code>device/sprd/qogirn6pro/jsp1621/media/bootanimation.zip</code> 拷贝为终端的<code>system/media/bootanimation.zip</code> 文件</p></li></ol> <h1 id="三、加载原理"><a href="#三、加载原理" class="header-anchor">#</a> 三、加载原理</h1> <p>相关文件：</p> <p><code>frameworks\base\cmds\bootanimation\BootAnimation.cpp</code></p> <p>在<code>threadLoop</code>中会判断，如果没有开机动画，则直接<code>android()</code>,否则调用<code>movie()</code></p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span> <span class="token class-name">BootAnimation</span><span class="token double-colon punctuation">::</span><span class="token function">threadLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">bool</span> result<span class="token punctuation">;</span>
    <span class="token comment">// We have no bootanimation file, so we use the stock android logo</span>
    <span class="token comment">// animation.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mZipFileName<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> <span class="token function">android</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> <span class="token function">movie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">eglMakeCurrent</span><span class="token punctuation">(</span>mDisplay<span class="token punctuation">,</span> EGL_NO_SURFACE<span class="token punctuation">,</span> EGL_NO_SURFACE<span class="token punctuation">,</span> EGL_NO_CONTEXT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">eglDestroyContext</span><span class="token punctuation">(</span>mDisplay<span class="token punctuation">,</span> mContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">eglDestroySurface</span><span class="token punctuation">(</span>mDisplay<span class="token punctuation">,</span> mSurface<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mFlingerSurface<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mFlingerSurfaceControl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">eglTerminate</span><span class="token punctuation">(</span>mDisplay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">eglReleaseThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IPCThreadState</span><span class="token double-colon punctuation">::</span><span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">stopProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span> <span class="token class-name">BootAnimation</span><span class="token double-colon punctuation">::</span><span class="token function">android</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">SLOGD</span><span class="token punctuation">(</span><span class="token string">&quot;%sAnimationShownTiming start time: %&quot;</span> PRId64 <span class="token string">&quot;ms&quot;</span><span class="token punctuation">,</span> mShuttingDown <span class="token operator">?</span> <span class="token string">&quot;Shutdown&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Boot&quot;</span><span class="token punctuation">,</span>
            <span class="token function">elapsedRealtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">BOOTANIMATION_EXT</span></span>
    <span class="token comment">// UNISOC: use small logo pictures on small screen devices @{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mWidth <span class="token operator">&lt;=</span> <span class="token number">160</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">initTexture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mAndroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mAssets<span class="token punctuation">,</span> <span class="token string">&quot;images/android-logo-mask-minimum.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initTexture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mAndroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mAssets<span class="token punctuation">,</span> <span class="token string">&quot;images/android-logo-shine-minimum.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mWidth <span class="token operator">&lt;=</span> <span class="token number">240</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">initTexture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mAndroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mAssets<span class="token punctuation">,</span> <span class="token string">&quot;images/android-logo-mask-little.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initTexture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mAndroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mAssets<span class="token punctuation">,</span> <span class="token string">&quot;images/android-logo-shine-little.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mWidth <span class="token operator">&lt;=</span> <span class="token number">480</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">initTexture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mAndroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mAssets<span class="token punctuation">,</span> <span class="token string">&quot;images/android-logo-mask-small.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initTexture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mAndroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mAssets<span class="token punctuation">,</span> <span class="token string">&quot;images/android-logo-shine-small.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">initTexture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mAndroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mAssets<span class="token punctuation">,</span> <span class="token string">&quot;images/android-logo-mask.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initTexture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mAndroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mAssets<span class="token punctuation">,</span> <span class="token string">&quot;images/android-logo-shine.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// @}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
    <span class="token function">initTexture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mAndroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mAssets<span class="token punctuation">,</span> <span class="token string">&quot;images/android-logo-mask.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">initTexture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mAndroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mAssets<span class="token punctuation">,</span> <span class="token string">&quot;images/android-logo-shine.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

    mCallbacks<span class="token operator">-&gt;</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// clear screen</span>
    <span class="token function">glShadeModel</span><span class="token punctuation">(</span>GL_FLAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDisable</span><span class="token punctuation">(</span>GL_DITHER<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDisable</span><span class="token punctuation">(</span>GL_SCISSOR_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glClearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">eglSwapBuffers</span><span class="token punctuation">(</span>mDisplay<span class="token punctuation">,</span> mSurface<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexEnvx</span><span class="token punctuation">(</span>GL_TEXTURE_ENV<span class="token punctuation">,</span> GL_TEXTURE_ENV_MODE<span class="token punctuation">,</span> GL_REPLACE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Blend state</span>
    <span class="token function">glBlendFunc</span><span class="token punctuation">(</span>GL_SRC_ALPHA<span class="token punctuation">,</span> GL_ONE_MINUS_SRC_ALPHA<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexEnvx</span><span class="token punctuation">(</span>GL_TEXTURE_ENV<span class="token punctuation">,</span> GL_TEXTURE_ENV_MODE<span class="token punctuation">,</span> GL_REPLACE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> nsecs_t startTime <span class="token operator">=</span> <span class="token function">systemTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        <span class="token function">processDisplayEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> GLint xc <span class="token operator">=</span> <span class="token punctuation">(</span>mWidth  <span class="token operator">-</span> mAndroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> GLint yc <span class="token operator">=</span> <span class="token punctuation">(</span>mHeight <span class="token operator">-</span> mAndroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>h<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> Rect <span class="token function">updateRect</span><span class="token punctuation">(</span>xc<span class="token punctuation">,</span> yc<span class="token punctuation">,</span> xc <span class="token operator">+</span> mAndroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">,</span> yc <span class="token operator">+</span> mAndroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">SLOGD</span><span class="token punctuation">(</span><span class="token string">&quot;updateRect Surface xc is %d,yc is %d,mAndroid[0].w is %d,mAndroid[0].h is %d&quot;</span><span class="token punctuation">,</span>xc<span class="token punctuation">,</span>yc<span class="token punctuation">,</span>mAndroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">,</span>mAndroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glScissor</span><span class="token punctuation">(</span>updateRect<span class="token punctuation">.</span>left<span class="token punctuation">,</span> mHeight <span class="token operator">-</span> updateRect<span class="token punctuation">.</span>bottom<span class="token punctuation">,</span> updateRect<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                updateRect<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        nsecs_t now <span class="token operator">=</span> <span class="token function">systemTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> time <span class="token operator">=</span> now <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
        <span class="token keyword">float</span> t <span class="token operator">=</span> <span class="token number">4.0f</span> <span class="token operator">*</span> <span class="token keyword">float</span><span class="token punctuation">(</span>time <span class="token operator">/</span> <span class="token function">us2ns</span><span class="token punctuation">(</span><span class="token number">16667</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> mAndroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">;</span>
        GLint offset <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token punctuation">(</span>t <span class="token operator">-</span> <span class="token function">floorf</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> mAndroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">;</span>
        GLint x <span class="token operator">=</span> xc <span class="token operator">-</span> offset<span class="token punctuation">;</span>

        <span class="token function">glDisable</span><span class="token punctuation">(</span>GL_SCISSOR_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_SCISSOR_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glDisable</span><span class="token punctuation">(</span>GL_BLEND<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> mAndroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glDrawTexiOES</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>                 yc<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mAndroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">,</span> mAndroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glDrawTexiOES</span><span class="token punctuation">(</span>x <span class="token operator">+</span> mAndroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">,</span> yc<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mAndroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">,</span> mAndroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_BLEND<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> mAndroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glDrawTexiOES</span><span class="token punctuation">(</span>xc<span class="token punctuation">,</span> yc<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mAndroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">,</span> mAndroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>

        EGLBoolean res <span class="token operator">=</span> <span class="token function">eglSwapBuffers</span><span class="token punctuation">(</span>mDisplay<span class="token punctuation">,</span> mSurface<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">==</span> EGL_FALSE<span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token comment">// 12fps: don't animate too fast to preserve CPU</span>
        <span class="token keyword">const</span> nsecs_t sleepTime <span class="token operator">=</span> <span class="token number">83333</span> <span class="token operator">-</span> <span class="token function">ns2us</span><span class="token punctuation">(</span><span class="token function">systemTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sleepTime <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token function">usleep</span><span class="token punctuation">(</span>sleepTime<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">checkExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">exitPending</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glDeleteTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>mAndroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDeleteTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>mAndroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br></div></div><p>没有开机动画的话，会调用<code>rameworks/base/core/res/assets/images/</code> 下的<code>android-logo-mask.png</code> 文件</p> <p>如果有的话会执行<code>movie()</code> :</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span> <span class="token class-name">BootAnimation</span><span class="token double-colon punctuation">::</span><span class="token function">movie</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mAnimation <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mAnimation <span class="token operator">=</span> <span class="token function">loadAnimation</span><span class="token punctuation">(</span>mZipFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>mAnimation <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token comment">// mCallbacks-&gt;init() may get called recursively,</span>
    <span class="token comment">// this loop is needed to get the same results</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Animation<span class="token double-colon punctuation">::</span>Part<span class="token operator">&amp;</span> part <span class="token operator">:</span> mAnimation<span class="token operator">-&gt;</span>parts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>part<span class="token punctuation">.</span>animation <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mCallbacks<span class="token operator">-&gt;</span><span class="token function">init</span><span class="token punctuation">(</span>part<span class="token punctuation">.</span>animation<span class="token operator">-&gt;</span>parts<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    mCallbacks<span class="token operator">-&gt;</span><span class="token function">init</span><span class="token punctuation">(</span>mAnimation<span class="token operator">-&gt;</span>parts<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">bool</span> anyPartHasClock <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mAnimation<span class="token operator">-&gt;</span>parts<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">validClock</span><span class="token punctuation">(</span>mAnimation<span class="token operator">-&gt;</span>parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            anyPartHasClock <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>anyPartHasClock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mClockEnabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Check if npot textures are supported</span>
    mUseNpotTextures <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    String8 gl_extensions<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> exts <span class="token operator">=</span> <span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">glGetString</span><span class="token punctuation">(</span>GL_EXTENSIONS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>exts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">glGetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        gl_extensions<span class="token punctuation">.</span><span class="token function">setTo</span><span class="token punctuation">(</span>exts<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>gl_extensions<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;GL_ARB_texture_non_power_of_two&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span>
            <span class="token punctuation">(</span>gl_extensions<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;GL_OES_texture_npot&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mUseNpotTextures <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Blend required to draw time on top of animation frames.</span>
    <span class="token function">glBlendFunc</span><span class="token punctuation">(</span>GL_SRC_ALPHA<span class="token punctuation">,</span> GL_ONE_MINUS_SRC_ALPHA<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glShadeModel</span><span class="token punctuation">(</span>GL_FLAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDisable</span><span class="token punctuation">(</span>GL_DITHER<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDisable</span><span class="token punctuation">(</span>GL_SCISSOR_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDisable</span><span class="token punctuation">(</span>GL_BLEND<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexEnvx</span><span class="token punctuation">(</span>GL_TEXTURE_ENV<span class="token punctuation">,</span> GL_TEXTURE_ENV_MODE<span class="token punctuation">,</span> GL_REPLACE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameterx</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_S<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameterx</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_T<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameterx</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameterx</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">bool</span> clockFontInitialized <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mClockEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        clockFontInitialized <span class="token operator">=</span>
            <span class="token punctuation">(</span><span class="token function">initFont</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mAnimation<span class="token operator">-&gt;</span>clockFont<span class="token punctuation">,</span> CLOCK_FONT_ASSET<span class="token punctuation">)</span> <span class="token operator">==</span> NO_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mClockEnabled <span class="token operator">=</span> clockFontInitialized<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>mClockEnabled <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">updateIsTimeAccurate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mTimeCheckThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">TimeCheckThread</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mTimeCheckThread<span class="token operator">-&gt;</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token string">&quot;BootAnimation::TimeCheckThread&quot;</span><span class="token punctuation">,</span> PRIORITY_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">playAnimation</span><span class="token punctuation">(</span><span class="token operator">*</span>mAnimation<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>mTimeCheckThread <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mTimeCheckThread<span class="token operator">-&gt;</span><span class="token function">requestExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mTimeCheckThread <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>clockFontInitialized<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">glDeleteTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>mAnimation<span class="token operator">-&gt;</span>clockFont<span class="token punctuation">.</span>texture<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">releaseAnimation</span><span class="token punctuation">(</span>mAnimation<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mAnimation <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br></div></div><p>一些文件路径定义也在该文件夹中</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> OEM_BOOTANIMATION_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/oem/media/bootanimation.zip&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> PRODUCT_BOOTANIMATION_DARK_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/product/media/bootanimation-dark.zip&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> PRODUCT_BOOTANIMATION_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/product/media/bootanimation.zip&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> SYSTEM_BOOTANIMATION_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/system/media/bootanimation.zip&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> APEX_BOOTANIMATION_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/apex/com.android.bootanimation/etc/bootanimation.zip&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> PRODUCT_ENCRYPTED_BOOTANIMATION_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/product/media/bootanimation-encrypted.zip&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> SYSTEM_ENCRYPTED_BOOTANIMATION_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/system/media/bootanimation-encrypted.zip&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> OEM_SHUTDOWNANIMATION_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/oem/media/shutdownanimation.zip&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> PRODUCT_SHUTDOWNANIMATION_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/product/media/shutdownanimation.zip&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> SYSTEM_SHUTDOWNANIMATION_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/system/media/shutdownanimation.zip&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token keyword">constexpr</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> PRODUCT_USERSPACE_REBOOT_ANIMATION_FILE <span class="token operator">=</span> <span class="token string">&quot;/product/media/userspace-reboot.zip&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">constexpr</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> OEM_USERSPACE_REBOOT_ANIMATION_FILE <span class="token operator">=</span> <span class="token string">&quot;/oem/media/userspace-reboot.zip&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">constexpr</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> SYSTEM_USERSPACE_REBOOT_ANIMATION_FILE <span class="token operator">=</span> <span class="token string">&quot;/system/media/userspace-reboot.zip&quot;</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">BOOTANIMATION_EXT</span></span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> PLAY_SOUND_PROP_NAME<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;persist.sys.bootanim.play_sound&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> BOOTREASON_PROP_NAME<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;ro.boot.bootreason&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span> PLAY_SOUND_BOOTREASON_BLACKLIST <span class="token punctuation">{</span>
  <span class="token string">&quot;kernel_panic&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Panic&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Watchdog&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/* UNISOC: added boot and shutdown animation ,define  path here @{ */</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> OEM_BOOTSOUND_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/oem/media/bootsound.mp3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> PRODUCT_BOOTSOUND_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/product/media/bootsound.mp3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> SYSTEM_BOOTSOUND_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/system/media/bootsound.mp3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> OEM_SHUTDOWNSOUND_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/oem/media/shutdownsound.mp3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> PRODUCT_SHUTDOWNSOUND_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/product/media/shutdownsound.mp3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> SYSTEM_SHUTDOWNSOUND_FILE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/system/media/shutdownsound.mp3&quot;</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ul><li>在开机动画播放过程中，<strong>在绘制每一帧之前</strong> 都会检测是否应该退出动画播放，一旦为<code>true</code>：
<ul><li>若当前正在播放<code>p</code>类型动画片段，则立即退出本段动画片段播放，直接进入到下一行<code>c</code>类型的动画片段播放。此时剩余的未播放的<code>p</code>类型动画都不会播放。</li> <li>若当前正在播放<code>c</code>类型动画片段，将正常播放完本段动画，然后进入到下一行<code>c</code>类型的动画片段播放。</li></ul></li> <li><code>c</code>类型的动画片段设置为无限循环播放是不生效的，此时动画片段只会播放一次。</li></ul> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>p <span class="token number">1</span> <span class="token number">0</span> part0  <span class="token comment">// 1. part0播放过程中，检测到退出播放</span>
p <span class="token number">2</span> <span class="token number">0</span> part1  <span class="token comment">// 2. 直接跳过</span>
c <span class="token number">2</span> <span class="token number">0</span> part2  <span class="token comment">// 3. 播放2次part2中的动画</span>
c <span class="token number">0</span> <span class="token number">0</span> part3  <span class="token comment">// 4. 播放1次part3中的动画</span>
p <span class="token number">1</span> <span class="token number">0</span> part4  <span class="token comment">// 5. 直接跳过，动画播放结束</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h1 id="四、修改开机logo"><a href="#四、修改开机logo" class="header-anchor">#</a> 四、修改开机logo</h1> <p>1.开机 <code>logo</code>和充电 <code>logo</code>资源位置</p> <p><code>vendor\sprd\release\bmp\unisoc_bmp</code></p> <p>2.根据你的编译选项使用对应 <code>logo bmp</code></p> <p><code>vendor\sprd\release\pac_config\sl9832e_1h10_64b.ini</code></p> <p>根据配置里面的路径修改</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>BootLogo=1@./vendor/sprd/release/bmp/unisoc_bmp/unisoc_FHD_1080_2160.bmp
 
Fastboot_Logo=1@./vendor/sprd/release/bmp/unisoc_bmp/unisoc_FHD_1080_2160.bmp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>注意<code>bmp</code>文件，不能直接修改后缀名，可以通过画图另存为<code>bmp</code>格式</p> <h1 id="五、参考"><a href="#五、参考" class="header-anchor">#</a> 五、参考</h1> <p>https://blog.csdn.net/JaniceZhou37/article/details/122867290
https://blog.csdn.net/qq_27061049/article/details/117752715
https://blog.csdn.net/xyb_2012/article/details/122970847
https://cczheng.blog.csdn.net/article/details/120380447</p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间: </span> <span class="time">2023-9-17 10:29:00 ├F10: AM┤</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blog/handbook/aidl/aidl.html" class="prev">
          AIDL详解
        </a></span> <span class="next"><a href="/blog/handbook/android/编译技巧.html">
          编译技巧
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/blog/handbook/android/Android%E5%BC%80%E6%9C%BA%E5%8A%A8%E7%94%BB%E8%AF%A6%E8%A7%A3.html#环境" class="sidebar-link reco-side-环境" data-v-b57cc07c>环境</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/handbook/android/Android%E5%BC%80%E6%9C%BA%E5%8A%A8%E7%94%BB%E8%AF%A6%E8%A7%A3.html#_1-1-bootanimation-zip文件详解" class="sidebar-link reco-side-_1-1-bootanimation-zip文件详解" data-v-b57cc07c>1.1 bootanimation.zip文件详解</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/handbook/android/Android%E5%BC%80%E6%9C%BA%E5%8A%A8%E7%94%BB%E8%AF%A6%E8%A7%A3.html#_1-2-desc-txt文件格式" class="sidebar-link reco-side-_1-2-desc-txt文件格式" data-v-b57cc07c>1.2 desc.txt文件格式</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/handbook/android/Android%E5%BC%80%E6%9C%BA%E5%8A%A8%E7%94%BB%E8%AF%A6%E8%A7%A3.html#_2-1-测试开机动画" class="sidebar-link reco-side-_2-1-测试开机动画" data-v-b57cc07c>2.1 测试开机动画</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/handbook/android/Android%E5%BC%80%E6%9C%BA%E5%8A%A8%E7%94%BB%E8%AF%A6%E8%A7%A3.html#_2-2-集成到系统中" class="sidebar-link reco-side-_2-2-集成到系统中" data-v-b57cc07c>2.2 集成到系统中</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/blog/assets/js/app.a89a3ba2.js" defer></script><script src="/blog/assets/js/3.b8b532c4.js" defer></script><script src="/blog/assets/js/1.4116e08c.js" defer></script><script src="/blog/assets/js/13.c337f25e.js" defer></script>
  </body>
</html>
